## 相似图片匹配

 版本库中的相似图片匹配所用的算法是“内容特征法”

### “内容特征法” 算法介绍
 * 基本思路：
  2. 将彩色图片转化为灰度图片
  2. 将灰度图片二值化
  2. 对两个（或多个）图片的二值化结果进行异或运算，异或运算结果越小，说明两个图片越相似。
 * 需要解决的问题：
  二值化图像的时候，不可以避免的需要寻找一个阈值，使得这个图片的主要内容轮廓突出来。这意味着需要寻找一个阈值，使得原图像的背景色和前景色差异明显，或者是背景色与前景色内部之间差异最小，即“类内差异最小”和“类间差异最大”。已有学者证明这两个概念是同一回事。
 * “类内差异最小” 和 “类间差异最大” 

假定一张图片共有n个像素，其中灰度值小于阈值的像素为 n1 个，大于等于阈值的像素为 n2 个（ n1 + n2 = n ）。w1 和 w2 表示这两种像素各自的比重。
　　*w1 = n1 / n*
　　*w2 = n2 / n*
再假定，所有灰度值小于阈值的像素的平均值和方差分别为 μ1 和 σ1，所有灰度值大于等于阈值的像素的平均值和方差分别为 μ2 和 σ2。于是，可以得到
　　*类内差异 = w1(σ1^2) + w2(σ2^2)*
　　*类间差异 = w1w2(μ1-μ2)^2*
可以证明，这两个式子是等价的：得到"类内差异"的最小值，等同于得到"类间差异"的最大值。不过，从计算难度看，后者的计算要容易一些。

### 参考资料
 * [相似图片搜索的原理](http://www.ruanyifeng.com/blog/2013/03/similar_image_search_part_ii.html)
